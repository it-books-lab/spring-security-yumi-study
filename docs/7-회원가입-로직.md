# 7강. 회원가입 로직

다른 코드들은 [7강 공식 필기노트](https://cafe.naver.com/xxxjjhhh/101) 참고하기

```java
import com.example.testsecurity.dto.JoinDTO;
import com.example.testsecurity.entity.UserEntity;
import com.example.testsecurity.repository.UserRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.stereotype.Service;

@Service
public class JoinService {

    @Autowired
    private UserRepository userRepository;

    @Autowired
    private BCryptPasswordEncoder bCryptPasswordEncoder;

    public void joinProcess(JoinDTO joinDTO) {
        boolean isUser = userRepository.existsByUsername(joinDTO.getUsername());
        if (isUser) {
            return;
        }
        
        UserEntity data = new UserEntity();

        data.setUsername(joinDTO.getUsername());
        data.setPassword(bCryptPasswordEncoder.encode(joinDTO.getPassword())); // 비밀번호는 암호화 후 저장
        data.setRole("ROLE_USER"); // 접두사로 "ROLE_"을 붙여줘야 스프링 시큐리티가 ROLE로 인식

        userRepository.save(data);
    }
}
```

```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception{

        http
                .authorizeHttpRequests((auth) -> auth
                        .requestMatchers("/", "/login", "/loginProc", "/join", "/joinProc").permitAll()
                        .requestMatchers("/admin").hasRole("ADMIN")
                        .requestMatchers("/my/**").hasAnyRole("ADMIN", "USER")
                        .anyRequest().authenticated()
                );
                
         (생략)
```

- "/join", "/joinProc"도 모든 유저 접근 가능으로 수정!

## 추가로 주의해야 할 점

- 프론트단에서도 회원가입 아이디 중복 확인 로직을 추가해야 한다.
    
<img width="733" height="525" alt="image" src="https://github.com/user-attachments/assets/6efa8a21-514a-4682-b656-51dd135c37ad" />
    
- 가입 불가 문자 정규식 처리가 필요하다.
    - 아이디/비밀번호의 자리 수
    - 아이디/비밀번호에 특수문자 포함 불가
    - admin과 같은 아이디 사용 불가


